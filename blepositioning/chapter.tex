\chapter{\BLE and indoor positioning}
\wordcount{blepositioning}

\section{\BLE}
\BLE (BLE), also known as Bluetooth Smart, or sometimes incorrectly referred to as Bluetooth 4.0\footnote{Bluetooth 4.0 is the fourth incarnation of the Bluetooth standard, which contains, among other things, \BLE.}, is a new wireless connection technology that is quickly gaining in popularity.
It was introduced in 2010 as part of the Bluetooth 4.0 standard; is not compatible with previous versions of Bluetooth (now often referred to as Bluetooth Classic), and is not meant to replace traditional Bluetooth; another part of the Bluetooth 4.0 standard does that.

\fig{\gnuplot{introduction}{ble-wifi}{\BLE advertising (blue) and data (red) channels, and \wifi channels, with the much-used 1/6/11 channel combination in bold.}}

BLE uses the same 2.4GHz frequency band as \wifi, Bluetooth Classic and many other radio devices.
In order to be able to operate in this busy band, BLE uses 40 channels, and during a connection an effort is made to only use channels with little interference.
Out of the 40 channels, channel 0 to channel 36 are used when a connection is made, and three channels (channel 37, 38 and 39) are advertising channels.
These advertising channels are used for discovery and connectionless information broadcast.
The three advertising channels are, as \figureref{introduction}{ble-wifi} shows, spaced throughout the spectrum, in order to minimise the chance that all three channels suffer from interference\citep{heydon2013bluetooth}.


\BLE is widely expected to be available in billions of devices within a couple of years.
In February 2014, all of the top 10 most sold smartphones support BLE\urlref{http://www.counterpointresearch.com/top-10-smartphones-in-february-2014}{4 June 2014}.
BLE transmitters and receivers are cheap (chips such as the rfd22301, which combines an ARM M0 core and a complete BLE system, are widely available for around \$15), and can run for years on small batteries\urlref{http://www.bluetooth.com/Pages/low-energy-tech-info.aspx}{4 June 2014}.
BLE is designed to allow many devices to co-exist in the same area\citep{heydon2013bluetooth}, and Android and iOS devices can listen for, interact with and connect to BLE devices directly from the \app without user intervention.

The above means that it is possible to relatively cheaply create a dense network of battery powered \BLE transmitters (beacons) in an area, which can be interacted with by \apps running on hardware that most people carry with them anyway.
This makes BLE a plausible candidate to provide indoor positioning.

\section{Positioning}
\define{Radiolocation} is the technique of determining a device's location with the use of radio waves.
This technique can be used to either determine location on the basis of a single measurement, or to track a device's movement over time.
The former is called \define{push-to-fix positioning} or \define{one-shot positioning} (and in this report I will usually just call it \define{positioning}), where the latter is known as \define{tracking}, and the obvious difference is that in tracking both information from the measurement itself and the history, possibly combined with information from other sensors, can be used, while \ptfp only has the one measurement to determine a location.
In this report I exclusively focus on \ptfp, however I believe that an improvement in \ptfp can also be used to improve tracking performance.

\subsection{Techniques}
Positioning can broadly be divided into two categories.
Either the device to be located can send a signal, which is received by stations in the environment, which determine the device's location (and then either send it back to the device or do something else with that information).
Alternatively stations in the environment can send out signals which the device receives.
Using these signals the device can determine its location.
This latter form is known as \define{opportunistic positioning}, both GPS and the \wifi positioning system (WPS) are examples of this form.

Several techniques can be used to do radiolocation; I mention some of the most used.
Time-Of-Arrival and Time-Difference-Of-Arrival use the fact that the radio waves travel at a limited speed to determine location.
This method is used by GPS, and requires accurately timed hardware, which is most likely not present in consumer BLE chips (however in \sectionref{architecture}{bats} I suggest a system that makes use of this technique in a different form).
Angle-Of-Arrival uses the direction from which a signal arrives to determine the location.
Even though most mobile phones do not have the hardware to directly determine the direction a BLE signal comes from, it is possible that something could be inferred indirectly from the signal strength.
Positioning using Received Signal Strength (RSS; or Received Signal Strength Indication RSSI) uses the fact that a signal has a different strength in different locations.
RSS is being used in many \wifi positioning systems, and both iOS and Android expose the RSS of received packets to \apps.
Sometimes the term path-loss is being used as well in this context.
Path-loss defines how much the signal strength has dropped between transmitter and receiver, and is defined as transmitter power - RSS.
Path-loss based and RSS based positioning therefore describe the same thing in most situations.

\section{Previous work}
Indoor positioning has been a much visited field.
One of the first systems is the \define{active badge} system, described in \citet{want1992active}, which uses badges with infra-red transmitters to determine one's location.
The \define{active bat system}\citep{harter2002anatomy} and the \define{cricket system}\citep{cricket} use a combination of radio and ultrasound signals to do positioning.
\citet{bahl2000radar} introduced \wifi positioning using the RSS from \wifi access points and a fingerprint database to determine a device's location indoors.
\citet{castro2001probabilistic} further looked into \wifi positioning, and \citet{pandya2003indoor} suggested using Bluetooth (Classic) to improve indoor positioning.
\citet{li2005method} looked at improved methods for building the fingerprint database, and \citet{shin2012enhanced} suggested improvements on the nearest-neighbour positioning algorithm.


\subsection{Current state of BLE positioning}
To my knowledge there is no published academic work on using \BLE for positioning.

The Bluetooth 4.0 standard does contain a \define{proximity profile (PXP)}\urlref{https://developer.bluetooth.org/TechnologyOverview/Pages/PXP.aspx}{4 June 2014}.
Using PXP, devices can receive alerts when they move out of range of another device; this is done using RSS.

Using iBeacons, iOS\footnote{and Android, although the system was developed by Apple for iOS devices} devices can offer location-aware functionality when inside an iBeacon-region\urlref{https://developer.apple.com/ios7/}{4 June 2014}.

Even though both systems allow for a certain level of location awareness, this is relative to a certain device or beacon.
There is no evidence that either is intended to be used to determine a location more accurately than close or far from a certain device or beacon.

